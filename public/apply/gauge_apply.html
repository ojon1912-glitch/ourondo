<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>심쿵게이지 신청 | 우리의 온도</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/style.css">
  <meta name="description" content="심쿵게이지, 우리의 온도 신청 페이지입니다.">
  <link rel="canonical" href="/apply/gauge_apply.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="심쿵게이지 신청 | 우리의 온도">
  <meta property="og:description" content="실시간 참여형 소개팅 게임, 심쿵게이지 신청 페이지입니다.">
  <meta property="og:url" content="/apply/gauge_apply.html">
  <meta property="og:image" content="/img/custom.jpg">
</head>

<body class="bg-gray-50">

<div id="header"></div>
<script src="/js/layout.js"></script>
<script>
  fetch("/components/header.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("header").innerHTML = html;
      if (typeof initHeader === "function") initHeader();
      if (typeof applyLoginState === "function") applyLoginState();
    })
    .catch(err => console.warn("header load failed", err));
</script>

  <!-- 일정표 -->
  <section class="max-w-5xl mx-auto px-1 py-14">
    <h2 class="text-4xl font-bold text-center mb-6 text-white">일정표</h2>
    <div class="grid grid-cols-1 gap-10">
      <div>
        <img src="/img/schedule/2602_sche.png" class="rounded-xl shadow-md" alt="우리의온도 일정표 이미지">
        <div class="mt-4 text-gray-300 text-sm leading-relaxed">
          <p class="font-semibold text-center text-white mb-2">심쿵게이지 일정 안내</p>
          <ul class="list-disc pl-5 text-transparent text-right space-y-1">
            <li>심쿵게이지는 실시간 참여형 소개팅 게임입니다.</li>
            <li>상세한 회차 및 시간은 위 일정표 이미지를 참고해주세요.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <main class="max-w-4xl mx-auto px-2 py-10 text-white">

    <h1 class="text-4xl text-white text-center font-bold mb-4">신청서</h1>

    <!-- 신청 폼 -->
    <form id="applyForm" class="space-y-10" enctype="multipart/form-data">

      <!-- 상품 타입 (Gauge=3) -->
      <input type="hidden" name="product_type" value="3" />

      <div>
        <label class="text-2xl block mb-2 font-semibold">신청 버전</label>
        <input
          type="text"
          value="심쿵게이지(Gauge)"
          disabled
          class="w-full p-3 rounded bg-gray-800 border text-xl border-gray-700 cursor-not-allowed"
        />
      </div>

      <!-- 신청 날짜 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">신청 날짜</label>
        <input
          type="date"
          name="apply_date"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
        />
      </div>

      <!-- 성별 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">성별</label>
        <select
          name="gender"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
        >
          <option value="">선택</option>
          <option value="M">남성</option>
          <option value="F">여성</option>
        </select>
      </div>

      <!-- 이름 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">이름</label>
        <input
          type="text"
          name="name"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
          placeholder="홍길동"
        />
      </div>

      <!-- 출생년도 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">출생년도</label>
        <label class="block mb-2 font-semibold">*연령 제한은 90년생까지이며, 프로필 적합도 기준 충족 시 소수 예외 승인될 수 있습니다.</label>
        <input
          type="number"
          name="birth_year"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
          placeholder="1995"
        />
      </div>

      <!-- 키 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">키 (cm)</label>
        <label class="block mb-2 font-semibold">* 남성분은 173cm 이상만 참여 가능합니다. <br/>
        *현장 기준 미달 시 추후 참여가 제한됩니다. <br/>
        *여성분들도 키 기재해주세요.</label>
        <input
          type="number"
          name="height"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
          placeholder="175"
        />
      </div>

      <!-- 연락처 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">연락처</label>
        <input
          type="text"
          name="contact"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
          placeholder="010-1234-5678"
        />
      </div>

      <!-- 직업 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">직업</label>
        <label class="block mb-2 font-semibold">*대학(원)생인 경우, 대학(원)생이라고 적어주세요. <br/>
        *남성분의 경우, 대학생(혹은 무직)은 참여 불가합니다.</label>
        <input
          type="text"
          name="job"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
          placeholder="직업을 입력해주세요"
        />
      </div>

      <!-- 직업 증명 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">직업 증명 파일 (1개)</label>
        <input
          type="file"
          name="job_file"
          accept="image/*,application/pdf"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
        />
      </div>

      <!-- MBTI -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">MBTI</label>
        <input
          type="text"
          name="mbti"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
          placeholder="ENFP"
        />
      </div>

      <!-- 유입경로 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">유입 경로</label>
        <select
          name="source"
          required
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
        >
          <option value="">선택</option>
          <option value="NAVER">네이버</option>
          <option value="INSTAGRAM">인스타그램</option>
          <option value="Recom">지인추천</option>
          <option value="ETC">기타</option>
        </select>
      </div>

      <!-- 사진 업로드 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">본인 사진 (2장 이상)</label>
        <label class="block mb-2 font-semibold">
          *한 장씩 또는 여러 장을 선택하여 업로드할 수 있습니다. <br/>
          *현재의 본인과 가장 비슷한 최근 사진을 최소 2장 업로드해주세요. <br/>
          *실물이 사진과 많이 다른 경우, 추후 재참여 불가합니다. <br/>
          *소개팅 목적으로만 사용되며, 참여 승낙이 안된 분의 자료는 폐기됩니다. <br/>
          *상반신 혹은 전신이 드러난 사진 업로드 부탁드려요.</label>
        <input
          type="file"
          id="photoInput"
          multiple
          accept="image/*"
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
        />
        <div id="photoPreview" class="flex flex-wrap gap-3 mt-3"></div>
        <p id="photoCount" class="text-sm text-gray-400 mt-1"></p>
      </div>

      <!-- 메시지 -->
      <div>
        <label class="text-2xl block mb-2 font-semibold">호스트에게 하고 싶은 말</label>
        <textarea
          name="message"
          rows="4"
          class="w-full p-3 rounded bg-gray-800 border border-gray-700"
          placeholder="자기소개나 요청사항을 적어주세요"
        ></textarea>
      </div>

      <!-- 약관 동의 -->
      <div class="flex items-start gap-3">
        <input type="checkbox" name="agree" value="true" required class="mt-1" />
        <div class="text-sm text-gray-300">
          개인정보 처리방침 및 아래 약관에 동의합니다.
          <button
            type="button"
            id="openPrivacyBtnApply"
            class="ml-2 underline text-gray-200 hover:text-white"
          >
            보기
          </button>
          <p class="text-sm text-gray-300 pt-1">- 행사 진행 및 홍보를 목적으로 사진 및 영상 촬영이 이루어질 수 있으며, 외부 공개 시에는 개인 식별이 어려운 형태(블러 처리 등)로 활용됩니다.</p>
          <p class="text-sm text-gray-300 pt-1">- 참여 승인 완료 후, 신청서 제출 기준 24시간 이내 개별 안내 연락을 드립니다.</p>
          <p class="text-sm text-gray-300 pt-1">- 행사 회차 시작 3일 전부터는 환불이 불가합니다.</p>
          <p class="text-sm text-gray-300 pt-1">- 행사 참여 시 본인 확인을 위한 신분증을 반드시 지참해 주시기 바랍니다.</p>
          <p class="text-sm text-gray-300 pt-1">- 승인 거절 처리된 경우, 거절 사유를 따로 안내해드리지 않습니다.</p>
          <p class="text-sm text-gray-300 pt-1">- 허위 정보 기재 시 블랙리스트에 등록되며 서비스 재이용이 제한될 수 있습니다.</p>
          <p class="text-sm text-gray-300 pt-1">- 행사 4일 전까지 취소 시 전액 환불</p>
          <p class="text-sm text-gray-300 pt-1">- 행사 3일 전~당일 취소 및 무단 불참 시 환불 불가</p>
        </div>
      </div>

      <!-- 신청 버튼 -->
      <button
        type="button"
        id="applyBtn"
        class="w-full bg-pink-500 text-3xl hover:bg-pink-600 text-white font-semibold py-3 rounded-full shadow"
      >
        신청하기
      </button>

      <!-- 로딩 오버레이 -->
      <div id="loadingOverlay" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/60">
        <div class="flex flex-col items-center gap-4">
          <div class="w-12 h-12 border-4 border-white border-t-pink-500 rounded-full animate-spin"></div>
          <p class="text-white text-lg font-semibold">신청 처리 중...</p>
        </div>
      </div>

      <p class="text-sm text-gray-400 text-center">
        신청 후 아래 카카오톡으로 연락을 남겨주시면 담당자가 더 빠르게 확인하여 안내드립니다.
      </p>

    </form>

    <!-- 문의 -->
    <div class="text-center mt-10">
      <p class="text-gray-400 text-sm">문의가 필요하신가요?</p>
      <a
        href="http://pf.kakao.com/_XxnxahX/chat"
        target="_blank"
        class="inline-block mt-2 bg-yellow-400 text-black px-5 py-2 rounded-full font-semibold hover:bg-yellow-500 transition"
      >
        카카오톡으로 문의하기
      </a>
    </div>

  </main>

<div id="footer"></div>
<script>
  fetch("/components/footer.html")
    .then(res => res.text())
    .then(html => {
    document.getElementById("footer").innerHTML = html;

    const modal = document.getElementById("privacyModal");
    const openBtn = document.getElementById("openPrivacyBtn");
    const closeBtn = document.getElementById("closePrivacyBtn");

    if (modal && openBtn && closeBtn) {
      openBtn.addEventListener("click", () => {
        modal.classList.remove("hidden");
        modal.classList.add("flex");
      });
      closeBtn.addEventListener("click", () => {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      });
    }
  });
</script>
<script src="/js/privacy-modal.js"></script>
<script src="/js/apply-autofill.js"></script>

<!-- 신청 JS -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("applyBtn");
  if (!btn) return alert("신청 버튼을 찾지 못했습니다.");

  const photoInput = document.getElementById("photoInput");
  const photoPreview = document.getElementById("photoPreview");
  const photoCount = document.getElementById("photoCount");
  const collectedPhotos = [];

  function renderPreview() {
    photoPreview.innerHTML = "";
    collectedPhotos.forEach((file, idx) => {
      const wrap = document.createElement("div");
      wrap.className = "relative";
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      img.className = "w-20 h-24 object-cover rounded border border-gray-600";
      const removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.textContent = "X";
      removeBtn.className = "absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center";
      removeBtn.onclick = () => { collectedPhotos.splice(idx, 1); renderPreview(); };
      wrap.appendChild(img);
      wrap.appendChild(removeBtn);
      photoPreview.appendChild(wrap);
    });
    photoCount.textContent = collectedPhotos.length > 0 ? collectedPhotos.length + "장 선택됨" : "";
  }

  photoInput.addEventListener("change", () => {
    const files = Array.from(photoInput.files);
    files.forEach(f => collectedPhotos.push(f));
    photoInput.value = "";
    renderPreview();
  });

  const applyPrivacyBtn = document.getElementById("openPrivacyBtnApply");
  if (applyPrivacyBtn) {
    applyPrivacyBtn.addEventListener("click", () => {
      const modal = document.getElementById("privacyModal");
      if (!modal) return;
      modal.classList.remove("hidden");
      modal.classList.add("flex");
    });
  }

  btn.addEventListener("click", async () => {
    if (collectedPhotos.length < 2) {
      return alert("본인 사진을 2장 이상 업로드해주세요.");
    }

    const overlay = document.getElementById("loadingOverlay");
    try {
      btn.disabled = true;
      overlay.classList.remove("hidden");

      const token = localStorage.getItem("token");
      const form = document.getElementById("applyForm");
      const formData = new FormData(form);

      collectedPhotos.forEach(f => formData.append("photos", f));

      const headers = {};
      if (token) headers.Authorization = "Bearer " + token;

      const res = await fetch("/api/apply", {
        method: "POST",
        headers,
        body: formData,
      });

      const data = await res.json();
      if (!res.ok) {
        overlay.classList.add("hidden");
        btn.disabled = false;
        return alert(data.error || "신청 실패");
      }

      alert("신청이 완료되었습니다!");
      location.href = "/pay/checkout.html?apply_seq=" + data.apply_seq;
    } catch (e) {
      console.error(e);
      overlay.classList.add("hidden");
      btn.disabled = false;
      alert("서버 오류");
    }
  });
});
</script>

<!-- body 설정 -->
<script>
  window.BODY_LAYOUT = {
    theme: "dark",
    bokeh: true
  };
</script>
<script src="/js/bodylayout.js"></script>

</body>
</html>
