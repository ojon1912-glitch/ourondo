<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§ˆì´í˜ì´ì§€ - ìš°ë¦¬ì˜ ì˜¨ë„</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50">

<!-- Header -->
<div id="header"></div>
<script src="/js/layout.js"></script>
<script>
  fetch("/components/header.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("header").innerHTML = html;
      initHeader();
      applyLoginState();
    });
</script>

<main class="max-w-xl mx-auto px-1 py-10">

  <h1 class="text-3xl font-bold mb-6 text-white">ë§ˆì´í˜ì´ì§€</h1>

  <!-- í”„ë¡œí•„ ì¹´ë“œ -->
  <div class="bg-zinc-900 p-6 rounded-lg shadow mb-8">
    <div class="flex items-center space-x-4">
      <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center text-gray-400">
        <span class="text-2xl">ğŸ‘¤</span>
      </div>
      <div>
        <div id="mypageName" class="text-xl font-bold text-white"></div>
        <div id="mypageId" class="text-gray-400"></div>
      </div>
    </div>
  </div>

  <!-- ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ -->
  <div class="space-y-4">

    <!-- ğŸ”¥ ê´€ë¦¬ì ì „ìš©: ì§€ì›ì ê´€ë¦¬ -->
    <a href="/mypage/apply.html"
       id="adminApplyBtn"
       class="hidden block bg-indigo-600 p-4 rounded-lg shadow hover:bg-indigo-700 transition text-white font-bold">
      ğŸ› ï¸ ì§€ì›ì ê´€ë¦¬
    </a>
    <a href="/mypage/userapply.html"
     class="block bg-black p-4 rounded-lg shadow hover:bg-gray-900 transition text-white">
      ğŸ“„ ì§€ì› ë‚´ì—­
    </a>
<!-- 
    <a href="/mypage/password.html"
       class="block bg-black p-4 rounded-lg shadow hover:bg-gray-900 transition text-white">
      ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    </a>
-->
    <a href="/mypage/mylist.html"
       class="block bg-black p-4 rounded-lg shadow hover:bg-gray-900 transition text-white">
      ğŸ“ ë‚´ê°€ ì“´ QnA
    </a>

    <a href="/mypage/payments.html"
       class="block bg-black p-4 rounded-lg shadow hover:bg-gray-900 transition text-white" onclick="return false;">
      ğŸ’³ ê²°ì œ ë‚´ì—­ (ì¤€ë¹„ì¤‘)
    </a>


<!-- ìš°ì¸¡ í•˜ë‹¨ íšŒì›íƒˆí‡´ -->
<div class="flex justify-end mt-10 ">
  <a href="/mypage/delete.html"
     class="text-xs text-gray-400 hover:text-gray-500 transition">
    íšŒì›íƒˆí‡´
  </a>
</div>



  </div>

</main>

<!-- Footer -->
<div id="footer"></div>
<script>
  fetch("/components/footer.html")
    .then(res => res.text())
    .then(html => (document.getElementById("footer").innerHTML = html));
</script>

<!-- ================= ëª¨ë‹¬ ================= -->
<script src="/js/privacy-modal.js"></script>


<!-- ğŸ”¥ ë§ˆì´í˜ì´ì§€ ë¡œì§ (JWT + ê´€ë¦¬ì ë¶„ê¸°) -->
<script>
(async function () {
  const token = localStorage.getItem("token");
  if (!token) {
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    location.href = "/auth/login.html";
    return;
  }

  try {
    const res = await fetch("/api/auth/me", {
      headers: { Authorization: `Bearer ${token}` }
    });

    if (!res.ok) throw new Error("ì¸ì¦ ì‹¤íŒ¨");

    const user = await res.json();

    // ê¸°ë³¸ ìœ ì € ì •ë³´
    document.getElementById("mypageName").textContent = user.user_name || "ì´ë¦„ ì—†ìŒ";
    document.getElementById("mypageId").textContent = "@" + user.user_id;

    // ğŸ”¥ ê´€ë¦¬ìë©´ ì§€ì›ì ê´€ë¦¬ ë²„íŠ¼ í‘œì‹œ
    if (user.is_admin === 1) {
      document.getElementById("adminApplyBtn").classList.remove("hidden");
    }

  } catch (err) {
    alert("ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
    localStorage.removeItem("token");
    location.href = "/auth/login.html";
  }
})();
</script>

<!-- body ì„¤ì • -->
<script>
  window.BODY_LAYOUT = {
    theme: "dark",
    bokeh: true
  };
</script>
<script src="/js/bodylayout.js"></script>

</body>
</html>
